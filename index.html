<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura Acquarello</title>
  <link rel="stylesheet" href="style.css">

  <!-- Estilos para recibo -->
  <style>
    #recibo {
      margin-top: 30px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      color: #000;
    }

    #recibo table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    #recibo th,
    #recibo td {
      border: 1px solid #000;
      padding: 8px;
      text-align: center;
    }

    #recibo h3 {
      margin-bottom: 10px;
      color: #333;
    }

    hr {
      border: 0;
      border-top: 1px solid #aaa;
      margin: 20px 0;
    }
  </style>

  <!-- Librerías necesarias -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <h1>Generador de Facturas</h1>

  <form id="facturaForm">
    <label>Fecha: <input type="date" id="fecha" required></label><br>
    <label>Desayunos: <input type="number" id="desayunos" required></label><br>
    <label>Almuerzos: <input type="number" id="almuerzos" required></label><br>
    <label>Cenas: <input type="number" id="cenas" required></label><br>
    <label>Bidones: <input type="number" id="bidones" required></label><br>
    <button type="submit">Agregar día</button>
  </form>

  <!-- Contenedor donde se muestran las facturas -->
  <div id="recibo">
    <p><strong>Factura generada aparecerá aquí.</strong></p>
  </div>

  <!-- Botón para descargar con html2pdf -->
  <button onclick="descargarPDF()">Descargar PDF</button>

  <!-- Script principal -->
  <script>
    // Lógica de generación y renderizado
    const registros = [];
    document.getElementById('facturaForm').addEventListener('submit', e => {
      e.preventDefault();
      const fecha = document.getElementById('fecha').value;
      const desayunos = parseInt(document.getElementById('desayunos').value);
      const almuerzos = parseInt(document.getElementById('almuerzos').value);
      const cenas = parseInt(document.getElementById('cenas').value);
      const bidones = parseInt(document.getElementById('bidones').value);

      registros.push({ fecha, desayunos, almuerzos, cenas, bidones });
      mostrarRecibo();
      e.target.reset();
      alert('Día agregado correctamente.');
    });

    function mostrarRecibo() {
      const precios = { desayuno: 2500, almuerzo: 3000, cena: 2800, bidon: 2041 };
      const reciboDiv = document.getElementById('recibo');
      reciboDiv.innerHTML = '';
      registros.forEach((r, i) => {
        const totalDes = r.desayunos * precios.desayuno;
        const totalAlm = r.almuerzos * precios.almuerzo;
        const totalCen = r.cenas * precios.cena;
        const totalBid = r.bidones * precios.bidon;
        const subtotal = totalDes + totalAlm + totalCen + totalBid;
        const iva = subtotal * 0.13;
        const total = subtotal + iva;

        const bloque = document.createElement('div');
        bloque.innerHTML = `
          <h3>Factura Acquarello - Día ${i + 1}</h3>
          <p><strong>Fecha:</strong> ${r.fecha}</p>
          <table>
            <thead>
              <tr><th>Ítem</th><th>Cantidad</th><th>Precio U</th><th>Total</th></tr>
            </thead>
            <tbody>
              <tr><td>Desayunos</td><td>${r.desayunos}</td><td>${precios.desayuno}</td><td>${totalDes}</td></tr>
              <tr><td>Almuerzos</td><td>${r.almuerzos}</td><td>${precios.almuerzo}</td><td>${totalAlm}</td></tr>
              <tr><td>Cenas</td><td>${r.cenas}</td><td>${precios.cena}</td><td>${totalCen}</td></tr>
              <tr><td>Bidones</td><td>${r.bidones}</td><td>${precios.bidon}</td><td>${totalBid}</td></tr>
              <tr><td colspan="3"><strong>Subtotal</strong></td><td>${subtotal.toFixed(2)}</td></tr>
              <tr><td colspan="3"><strong>IVA (13%)</strong></td><td>${iva.toFixed(2)}</td></tr>
              <tr><td colspan="3"><strong>Total</strong></td><td>${total.toFixed(2)}</td></tr>
            </tbody>
          </table>
          <hr>
        `;
        reciboDiv.appendChild(bloque);
      });
    }

    // Función para descargar con html2pdf
    function descargarPDF() {
      const elemento = document.getElementById('recibo');
      const opciones = {
        margin:       0.5,
        filename:     'recibo.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opciones).from(elemento).save();
    }
  </script>
</body>
</html>

